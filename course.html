<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Details - Fearless Trading</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/styleguide.css">
    <link rel="stylesheet" href="css/course.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Initialize Supabase client
        const supabaseUrl = 'https://nzvchbubsvztqlibvvwa.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56dmNoYnVic3Z6dHFsaWJ2dndhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk1NDkxNTMsImV4cCI6MjA1NTEyNTE1M30.U_0p8uOucV6MBVemkG43zyb9hkDPSiD9AFHhUOIM4jc';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
    </script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <!-- Add EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script>
        // Initialize EmailJS
        (function() {
            emailjs.init("kF1JhrFnnqyBIzBh3");
        })();
    </script>
</head>
<body>
    <nav class="nav">
        <div class="logo"><h1>Fearless Trading</h1></div>
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="links">
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="#">About</a></li>
                <li><a href="course.html">Courses</a></li>
            </ul>
        </div>
        <div class="button">
            <button>Courses <span><img src="img/Line 1.png" alt=""></span></button>
        </div>
    </nav>

    <section class="cours" aria-label="Course Information">
        <div class="div">
            <div class="ellipse" role="presentation"></div>
            <div class="frame">
                <h2 class="text-wrapper">Our Course Plan</h2>
                <h3 class="duration">Funded Account Mastery</h3>
                <p class="p">Duration: 30 Days | Price: ₹4,999</p>
                <div class="group">
                    <ul class="all-brokers-accepted" aria-label="Course Features">
                        <li><img src="img/Frame 30.svg" alt="checkmark" role="presentation"> All brokers accepted</li>
                        <li><img src="img/Frame 30.svg" alt="checkmark" role="presentation"> Funded account clearance guidance</li>
                        <li><img src="img/Frame 30.svg" alt="checkmark" role="presentation"> Full mentorship access</li>
                        <li><img src="img/Frame 30.svg" alt="checkmark" role="presentation"> Live trading sessions</li>
                        <li><img src="img/Frame 30.svg" alt="checkmark" role="presentation"> 24/7 support access</li>
                        <li><img src="img/Frame 30.svg" alt="checkmark" role="presentation"> Trading psychology sessions</li>
                    </ul>
                </div>
                <img class="frame-4" src="img/Frame 28.png" alt="Course Preview" />
                <p class="spots-are-limited">
                    <span class="span">"Spots are</span>
                    <span class="text-wrapper-2"> limited</span>
                    <span class="span">. Enrollment closes soon —</span>
                    <span class="text-wrapper-2"> don't miss</span>
                    <span class="span"> your breakthrough moment."</span>
                </p>
            </div>
            <img class="rectangle" src="img/lap.png" alt="Trading Setup" style="border-radius: 25px;"/>
        </div>
    </section>

    <section class="course-content">
        <div class="content-wrapper">
            <div class="content-header">
                <h2>Course Content</h2>
                <p>Master Trading in 4 Comprehensive Modules</p>
            </div>
            
            <div class="content-grid">
                <div class="content-card">
                    <div class="card-number">01</div>
                    <h3>Trading Fundamentals</h3>
                    <ul>
                        <li>Basic market concepts</li>
                        <li>Chart analysis basics</li>
                        <li>Risk management principles</li>
                        <li>Trading psychology introduction</li>
                    </ul>
                </div>

                <div class="content-card">
                    <div class="card-number">02</div>
                    <h3>Advanced Strategies</h3>
                    <ul>
                        <li>Technical analysis mastery</li>
                        <li>Entry and exit strategies</li>
                        <li>Position sizing techniques</li>
                        <li>Market sentiment analysis</li>
                    </ul>
                </div>

                <div class="content-card">
                    <div class="card-number">03</div>
                    <h3>Funded Account Preparation</h3>
                    <ul>
                        <li>Prop firm requirements</li>
                        <li>Risk management rules</li>
                        <li>Trading plan development</li>
                        <li>Performance tracking</li>
                    </ul>
                </div>

                <div class="content-card">
                    <div class="card-number">04</div>
                    <h3>Live Trading & Support</h3>
                    <ul>
                        <li>Live trading sessions</li>
                        <li>Real-time analysis</li>
                        <li>Trade review sessions</li>
                        <li>Community support</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <section class="faq-section" aria-labelledby="faq-heading">
        <div class="text-container">
            <h1 id="faq-heading" class="heading">
                <span>Frequently</span>
                <span class="asked-questions"> Asked Questions</span>
            </h1>
            <p class="paragraph">Still have questions? Contact our Team via <a href="mailto:support@fearlesstrading.com">support@fearlesstrading.com</a></p>
        </div>
        <div class="container">
            <div class="faq-grid" role="list">
                <article class="faq-item" role="listitem">
                    <h2 class="heading1">What's included in the course?</h2>
                    <div class="line" aria-hidden="true"></div>
                    <p class="paragraph">Our comprehensive program includes live trading sessions, market analysis, risk management strategies, and personal mentoring.</p>
                </article>
                <article class="faq-item" role="listitem">
                    <h2 class="heading1">How long do I have access?</h2>
                    <div class="line" aria-hidden="true"></div>
                    <p class="paragraph">You get lifetime access to the course materials and 30 days of intensive mentorship to ensure your success.</p>
                </article>
                <article class="faq-item" role="listitem">
                    <h2 class="heading1">Is there a refund policy?</h2>
                    <div class="line" aria-hidden="true"></div>
                    <p class="paragraph">Yes, we offer a 7-day money-back guarantee if you're not satisfied with the course content.</p>
                </article>
                <article class="faq-item" role="listitem">
                    <h2 class="heading1">What support is provided?</h2>
                    <div class="line" aria-hidden="true"></div>
                    <p class="paragraph">You get 24/7 access to our support team, weekly Q&A sessions, and a private community of traders.</p>
                </article>
            </div>
        </div>
    </section>

    <footer class="site-footer">
        <div class="frame1">
            <div class="div">
                <div class="overlap">
                    <div class="overlap-group">
                        <div class="footer-content">
                            <div class="footer-header">
                                <h2 class="text-wrapper">Ready to start trading?</h2>
                                <p class="text-wrapper-2">Join us today <span><img class="line" src="img/Line 1.svg" alt="" role="presentation" /></span></p>
                            </div>
                            <div class="footer-main">
                                <div class="brand">Fearless<br />Trading</div>
                                <div class="footer-links">
                                    <div class="contact-info">
                                        <a href="tel:+8085550111" class="contact-link">+(808) 555-0111</a>
                                        <a href="mailto:support@fearlesstrading.com" class="contact-link">support@fearlesstrading.com</a>
                                    </div>
                                    <nav class="social-links" aria-label="Social Media Links">
                                        <a href="#" class="social-link">
                                            <span class="social-icon"></span>
                                            <span>Instagram</span>
                                        </a>
                                        <a href="#" class="social-link">
                                            <span class="social-icon"></span>
                                            <span>Telegram</span>
                                        </a>
                                        <a href="#" class="social-link">
                                            <span class="social-icon"></span>
                                            <span>Whatsapp</span>
                                        </a>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="footer-bottom">
                    <div class="copyright-text">20l media</div>
                    <p class="copyright">&copy; 2024-2025 Fearless Trading, All Rights Reserved</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const hamburger = document.querySelector('.hamburger');
            const navLinks = document.querySelector('.links');

            hamburger.addEventListener('click', (e) => {
                e.stopPropagation();
                hamburger.classList.toggle('active');
                navLinks.classList.toggle('active');
            });

            document.addEventListener('click', (e) => {
                if (navLinks.classList.contains('active') && 
                    !hamburger.contains(e.target) && 
                    !navLinks.contains(e.target)) {
                    hamburger.classList.remove('active');
                    navLinks.classList.remove('active');
                }
            });
        });
    </script>

<!-- Course Access Form Modal -->
<div class="form-modal" id="accessForm">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Get Course Access</h2>
        <p>Fill in your details to proceed with enrollment</p>
        
        <form id="courseAccessForm">
            <!-- Update the form section in your HTML -->
            <div class="form-group">
                <div class="phone-input">
                    <span class="country-code">+91</span>
                    <input type="tel" id="mobile" name="mobile" pattern="[6-9][0-9]{9}" maxlength="10" required>
                    <label for="mobile">Mobile Number</label>
                </div>
                <small class="input-hint">Enter valid Indian mobile number (10 digits)</small>
            </div>
            
            <div class="form-group">
                <input type="text" id="fullName" name="fullName" pattern="[A-Za-z ]{3,50}" required>
                <label for="fullName">Full Name</label>
                <small class="input-hint">Only letters and spaces allowed (3-50 characters)</small>
            </div>
            
            <div class="form-group">
                <input type="email" id="email" name="email" pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+[.][a-zA-Z]{2,}" required>
                <label for="email">Email Address</label>
                <small class="input-hint">Enter a valid email address</small>
            </div>
            
            <!-- Remove this entire script block from here -->
            
            <script>
            document.getElementById('mobile').addEventListener('input', function(e) {
                // Only allow numbers
                this.value = this.value.replace(/[^0-9]/g, '');
                
                // Ensure first digit is 6-9
                if (this.value.length > 0 && !'6789'.includes(this.value[0])) {
                    this.value = '';
                }
                
                // Limit to 10 digits
                if (this.value.length > 10) {
                    this.value = this.value.slice(0, 10);
                }
            });
            
            document.getElementById('fullName').addEventListener('input', function(e) {
                // Only allow letters and spaces
                this.value = this.value.replace(/[^A-Za-z ]/g, '');
            });
            
            document.getElementById('courseAccessForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const mobile = document.getElementById('mobile').value;
                const name = document.getElementById('fullName').value;
                const email = document.getElementById('email').value;
                const experience = document.getElementById('experience').value;
                
                // Basic validation
                if (mobile.length !== 10 || !'6789'.includes(mobile[0])) {
                    alert('Please enter a valid Indian mobile number');
                    return;
                }
                
                if (name.length < 3 || name.length > 50) {
                    alert('Name must be between 3 and 50 characters');
                    return;
                }
                
                const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                if (!emailRegex.test(email)) {
                    alert('Please enter a valid email address');
                    return;
                }

                try {
                    // Check if email already exists
                    const { data: existingUser, error: checkError } = await supabase
                        .from('registrations')
                        .select('email')
                        .eq('email', email)
                        .single();

                    if (checkError && checkError.code !== 'PGRST116') {
                        alert('Error checking user. Please try again.');
                        return;
                    }
                    if (existingUser) {
                        alert('This email is already registered. Please use a different email address.');
                        return;
                    }

                    // Razorpay payment
                    const options = {
                        key: "rzp_test_wIjWq2eShK4WES",
                        amount: 589882, // ₹5,898.82 in paise
                        currency: "INR",
                        name: "20L Media",
                        description: "Funded Account Mastery Course",
                        image: "img/logo.jpeg",
                        prefill: { name, email, contact: mobile },
                        notes: { experience_level: experience, course_name: 'Funded Account Mastery' },
                        handler: async function(response) {
                            // Payment successful, now insert registration
                            const registrationData = {
                                full_name: name,
                                email: email,
                                mobile: mobile,
                                experience_level: experience,
                                course_name: 'Funded Account Mastery',
                                amount: 4999,
                                gst: 899.82,
                                total_amount: 5898.82,
                                enrollment_date: new Date().toISOString(),
                                status: 'Completed',
                                payment_id: response.razorpay_payment_id
                            };

                            const { data, error: insertError } = await supabase
                                .from('registrations')
                                .insert([registrationData])
                                .select()
                                .single();

                            if (insertError) {
                                alert('Payment succeeded, but registration failed. Please contact support.');
                                return;
                            }

                            // Send confirmation email
                            const emailParams = {
                                to_name: name,
                                course_name: 'Funded Account Mastery',
                                payment_id: response.razorpay_payment_id,
                                amount: '₹5,898.82',
                                mobile: mobile,
                                experience_level: experience,
                                email: email // <-- This is required for the "To Email" field!
                            };
                            emailjs.send('service_3rfzrlc', 'template_sou4044', emailParams, 'kF1JhrFnnqyBIzBh3')
                                .then(function(response) {
                                    window.location.href = '/thank-you.html';
                                }, function(error) {
                                    alert('Payment successful, but there was an issue sending the welcome email. Our team will contact you shortly.');
                                    window.location.href = '/thank-you.html';
                                });
                        },
                        theme: { color: "#3399cc" }
                    };
                    const rzp1 = new Razorpay(options);
                    rzp1.on('payment.failed', function (response){
                        alert('Payment Failed: ' + response.error.description);
                        supabase
                            .from('registrations')
                            .update({ status: 'Cancelled', payment_id: response.error.metadata.payment_id, updated_at: new Date().toISOString() })
                            .eq('email', email);
                    });
                    rzp1.open();

                } catch (err) {
                    alert('An unexpected error occurred. Please try again.');
                    console.error(err);
                }
            });
            </script>
            
            <div class="form-group">
                <select id="experience" name="experience" required>
                    <option value="">Select your trading experience</option>
                    <option value="beginner">Beginner (0-1 year)</option>
                    <option value="intermediate">Intermediate (1-3 years)</option>
                    <option value="advanced">Advanced (3+ years)</option>
                </select>
            </div>

<script>
    function applyCoupon() {
        const couponCode = document.getElementById('couponCode').value;
        const couponMessage = document.getElementById('couponMessage');
        const priceDetails = document.querySelectorAll('.price-details .amount');
        const proceedButton = document.querySelector('.modal-content button[type="submit"]');
        
        if (couponCode === 'Free_of_cost') {
            // Apply 100% discount
            priceDetails.forEach(price => {
                price.textContent = '₹0';
            });
            
            couponMessage.style.display = 'block';
            couponMessage.style.color = '#28a745';
            couponMessage.textContent = 'Coupon applied successfully! 100% discount';
            
            // Store the discounted values globally
            window.discountedValues = {
                amount: 0,
                basePrice: 0,
                gst: 0,
                totalAmount: 0,
                isFree: true
            };
            
            // Update the proceed button text
            if (proceedButton) {
                proceedButton.textContent = 'Proceed to Enrollment';
            }
        } else {
            couponMessage.style.display = 'block';
            couponMessage.style.color = '#dc3545';
            couponMessage.textContent = 'Invalid coupon code';
            
            // Reset to original prices
            priceDetails[0].textContent = '₹4,999';
            priceDetails[1].textContent = '₹899.82';
            
            // Reset the stored values
            window.discountedValues = {
                amount: 589882, // Original amount in paise
                basePrice: 4999,
                gst: 899.82,
                totalAmount: 5898.82
            };
            
            // Reset the proceed button text
            if (proceedButton) {
                proceedButton.textContent = 'Proceed to Checkout - ₹5,898.82';
            }
        }
    }
</script>
            <div class="form-group">
                <input type="text" id="couponCode" name="couponCode" placeholder="Enter coupon code">
                <button type="button" onclick="applyCoupon()" class="coupon-btn">Apply Coupon</button>
                <p id="couponMessage" style="margin-top: 10px; display: none;"></p>
            </div>

            <div class="checkout-summary">
                <div class="price-details">
                    <span>Course Fee:</span>
                    <span class="amount">₹4,999</span>
                </div>
                <div class="price-details gst">
                    <span>GST (18%):</span>
                    <span class="amount">₹899.82</span>
                </div>
                <div class="price-details total">
                    <span>Total Amount:</span>
                    <span class="amount">₹5,898.82</span>
                </div>
            </div>
            
            <button type="submit" class="submit-btn">
                Proceed to Checkout - ₹5,898.82
                <span class="btn-note">*Inclusive of GST</span>
            </button>
        </form>
    </div>
</div>

<script>
// Form Modal JavaScript
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('accessForm');
    const getAccessBtn = document.querySelector('.frame-4'); // Your Frame 28 image
    const closeBtn = document.querySelector('.close-modal');
    
    getAccessBtn.addEventListener('click', function() {
        modal.style.display = 'flex';
    });
    
    closeBtn.addEventListener('click', function() {
        modal.style.display = 'none';
    });
    
    window.addEventListener('click', function(event) {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Hamburger menu logic
    const hamburger = document.querySelector('.hamburger');
    const navLinks = document.querySelector('.links');
    hamburger.addEventListener('click', (e) => {
        e.stopPropagation();
        hamburger.classList.toggle('active');
        navLinks.classList.toggle('active');
    });
    document.addEventListener('click', (e) => {
        if (navLinks.classList.contains('active') && 
            !hamburger.contains(e.target) && 
            !navLinks.contains(e.target)) {
            hamburger.classList.remove('active');
            navLinks.classList.remove('active');
        }
    });

    // Form validation and submission
    const form = document.getElementById('courseAccessForm');
    if (form) {
        // Input restrictions
        const mobileInput = document.getElementById('mobile');
        const nameInput = document.getElementById('fullName');
        if (mobileInput) {
            mobileInput.addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
                if (this.value.length > 0 && !'6789'.includes(this.value[0])) {
                    this.value = '';
                }
                if (this.value.length > 10) {
                    this.value = this.value.slice(0, 10);
                }
            });
        }
        if (nameInput) {
            nameInput.addEventListener('input', function() {
                this.value = this.value.replace(/[^A-Za-z ]/g, '');
            });
        }

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            const mobile = mobileInput.value;
            const name = nameInput.value;
            const email = document.getElementById('email').value;
            const experienceInput = document.getElementById('experience');
            const experience = experienceInput ? experienceInput.value : '';

            // Validation
            if (mobile.length !== 10 || !'6789'.includes(mobile[0])) {
                alert('Please enter a valid Indian mobile number');
                return;
            }
            if (name.length < 3 || name.length > 50) {
                alert('Name must be between 3 and 50 characters');
                return;
            }
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            if (!emailRegex.test(email)) {
                alert('Please enter a valid email address');
                return;
            }

            try {
                // Check if email already exists
                const { data: existingUser, error: checkError } = await supabase
                    .from('registrations')
                    .select('email')
                    .eq('email', email)
                    .single();

                if (checkError && checkError.code !== 'PGRST116') {
                    alert('Error checking user. Please try again.');
                    return;
                }
                if (existingUser) {
                    alert('This email is already registered. Please use a different email address.');
                    return;
                }

                // Check if coupon was applied
                if (window.discountedValues && window.discountedValues.isFree) {
                    // Direct registration without payment
                    const registrationData = {
                        full_name: name,
                        email: email,
                        mobile: mobile,
                        experience_level: experience,
                        course_name: 'Funded Account Mastery',
                        amount: 0,
                        gst: 0,
                        total_amount: 0,
                        enrollment_date: new Date().toISOString(),
                        status: 'Completed',
                        payment_id: 'COUPON_FREE_' + Date.now()
                    };

                    const { data, error: insertError } = await supabase
                        .from('registrations')
                        .insert([registrationData])
                        .select()
                        .single();

                    if (insertError) {
                        alert('Registration failed. Please contact support.');
                        return;
                    }

                    // Send confirmation email
                    const emailParams = {
                        to_name: name,
                        course_name: 'Funded Account Mastery',
                        payment_id: registrationData.payment_id,
                        amount: '₹0 (Coupon Applied)',
                        mobile: mobile,
                        experience_level: experience,
                        email: email
                    };

                    emailjs.send('service_3rfzrlc', 'template_sou4044', emailParams, 'kF1JhrFnnqyBIzBh3')
                        .then(function(response) {
                            window.location.href = '/thank-you.html';
                        }, function(error) {
                            alert('Registration successful, but there was an issue sending the welcome email. Our team will contact you shortly.');
                            window.location.href = '/thank-you.html';
                        });
                } else {
                    // Regular Razorpay payment flow
                    // ... existing code ...
                }
            } catch (err) {
                alert('An unexpected error occurred. Please try again.');
                console.error(err);
            }
        });
    }
});
</script>
</body>
</html>